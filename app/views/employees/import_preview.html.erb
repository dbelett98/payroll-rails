<!-- app/views/employees/import_form.html.erb -->

<div class="dashboard-wrapper">
  <div class="import-form-container">
    <!-- Header -->
    <div class="import-header">
      <h1 class="import-title">
        <span class="import-icon">üìä</span>
        Import Employees - <%= @client.name %>
      </h1>
      <p class="import-subtitle">Upload a CSV file to import employees for this client</p>
    </div>

    <!-- Instructions -->
    <div class="import-instructions">
      <h3>üìã CSV Format Requirements</h3>
      <div class="instruction-grid">
        <div class="instruction-item">
          <strong>Required Headers:</strong>
          <ul>
            <li>Name</li>
            <li>Salary</li>
          </ul>
        </div>
        <div class="instruction-item">
          <strong>Optional Headers:</strong>
          <ul>
            <li>Title</li>
            <li>Department</li>
            <li>Hours</li>
            <li>Phone</li>
            <li>Email</li>
            <li>Hire Date</li>
            <li>Employment Type</li>
            <li>Status</li>
          </ul>
        </div>
      </div>
      
      <div class="format-notes">
        <p><strong>Format Notes:</strong></p>
        <ul>
          <li>Salary: Can include $ and commas (e.g., $50,000 or 50000)</li>
          <li>Hours: Defaults to 40 if not provided</li>
          <li>Employment Type: W2 or 1099 (defaults to W2)</li>
          <li>Status: Active or Inactive (defaults to Active)</li>
          <li>Hire Date: Any common date format (MM/DD/YYYY, YYYY-MM-DD, etc.)</li>
        </ul>
      </div>
    </div>

    <!-- Upload Form -->
    <div class="upload-section">
      <%= form_with url: import_preview_employees_path, method: :post, local: true, multipart: true, class: "upload-form" do |f| %>
        <%= f.hidden_field :client_id, value: @client.id %>
        
        <div class="file-upload-area" id="file-upload-area">
          <div class="upload-content">
            <div class="upload-icon">üìÅ</div>
            <h3>Choose CSV File</h3>
            <p>Click to browse or drag and drop your CSV file here</p>
            <%= f.file_field :file, 
                accept: ".csv", 
                class: "file-input",
                id: "csv-file-input",
                required: true %>
          </div>
          
          <div class="file-info" id="file-info" style="display: none;">
            <div class="file-details">
              <span class="file-name" id="file-name"></span>
              <span class="file-size" id="file-size"></span>
            </div>
            <button type="button" class="remove-file-btn" id="remove-file-btn">‚úï</button>
          </div>
        </div>
        
        <div class="upload-actions">
          <%= link_to dashboard_path(client_id: @client.id), class: "btn btn-secondary" do %>
            <span class="btn-icon">‚¨ÖÔ∏è</span> Back to Dashboard
          <% end %>
          
          <button type="submit" class="btn btn-primary" id="upload-submit" disabled>
            <span class="btn-icon">üîç</span> Preview Import
          </button>
        </div>
      <% end %>
    </div>

    <!-- Sample CSV Template -->
    <div class="template-section">
      <h3>üìÑ Download Sample Template</h3>
      <p>Need a starting point? Download our sample CSV template with the correct headers.</p>
      
      <div class="template-download">
        <a href="#" class="btn btn-secondary" id="download-template">
          <span class="btn-icon">‚¨áÔ∏è</span> Download CSV Template
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  /* Import Form Styles */
  .import-form-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
  }

  .import-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .import-title {
    font-size: 2rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
  }

  .import-icon {
    font-size: 2rem;
  }

  .import-subtitle {
    color: #6b7280;
    font-size: 1.1rem;
  }

  /* Instructions */
  .import-instructions {
    background: #f0f9ff;
    border: 1px solid #0ea5e9;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .import-instructions h3 {
    color: #0c4a6e;
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }

  .instruction-grid {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 1.5rem;
    margin-bottom: 1rem;
  }

  .instruction-item {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid #bae6fd;
  }

  .instruction-item strong {
    color: #1e40af;
    display: block;
    margin-bottom: 0.5rem;
  }

  .instruction-item ul {
    margin: 0;
    padding-left: 1.25rem;
  }

  .instruction-item li {
    margin-bottom: 0.25rem;
    color: #374151;
  }

  .format-notes {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid #bae6fd;
  }

  .format-notes strong {
    color: #1e40af;
  }

  .format-notes ul {
    margin: 0.5rem 0 0 1.25rem;
  }

  .format-notes li {
    margin-bottom: 0.25rem;
    color: #374151;
    font-size: 0.9rem;
  }

  /* Upload Section */
  .upload-section {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    margin-bottom: 2rem;
  }

  .file-upload-area {
    border: 3px dashed #d1d5db;
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    background: #fafafa;
    margin-bottom: 1.5rem;
  }

  .file-upload-area:hover {
    border-color: #667eea;
    background: #f8fafc;
  }

  .file-upload-area.dragover {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  }

  .upload-content {
    pointer-events: none;
  }

  .upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .upload-content h3 {
    color: #374151;
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
  }

  .upload-content p {
    color: #6b7280;
    font-size: 1rem;
  }

  .file-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }

  .file-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f0f9ff;
    border: 1px solid #0ea5e9;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
  }

  .file-details {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .file-name {
    font-weight: 600;
    color: #1e40af;
  }

  .file-size {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .remove-file-btn {
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
  }

  .remove-file-btn:hover {
    background: #dc2626;
  }

  /* Upload Actions */
  .upload-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #upload-submit:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  #upload-submit:disabled:hover {
    background: #9ca3af;
    transform: none;
    box-shadow: none;
  }

  /* Template Section */
  .template-section {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
  }

  .template-section h3 {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .template-section p {
    color: #6b7280;
    margin-bottom: 1rem;
  }

  .template-download {
    display: flex;
    justify-content: center;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .import-form-container {
      padding: 1rem;
    }

    .instruction-grid {
      grid-template-columns: 1fr;
    }

    .file-upload-area {
      padding: 2rem 1rem;
    }

    .upload-actions {
      flex-direction: column;
      gap: 1rem;
    }

    .upload-actions .btn {
      width: 100%;
      text-align: center;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ Import Form Initialized');
  
  // Elements
  const fileInput = document.getElementById('csv-file-input');
  const uploadArea = document.getElementById('file-upload-area');
  const fileInfo = document.getElementById('file-info');
  const fileName = document.getElementById('file-name');
  const fileSize = document.getElementById('file-size');
  const removeFileBtn = document.getElementById('remove-file-btn');
  const uploadSubmit = document.getElementById('upload-submit');
  const downloadTemplate = document.getElementById('download-template');
  
  // File selection handling
  fileInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      displayFileInfo(file);
    }
  });
  
  // Drag and drop functionality
  uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('dragover');
  });
  
  uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
  });
  
  uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      const file = files[0];
      if (file.type === 'text/csv' || file.name.toLowerCase().endsWith('.csv')) {
        fileInput.files = files;
        displayFileInfo(file);
      } else {
        alert('Please drop a CSV file.');
      }
    }
  });
  
  // Display file information
  function displayFileInfo(file) {
    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);
    fileInfo.style.display = 'flex';
    uploadSubmit.disabled = false;
    uploadSubmit.innerHTML = '<span class="btn-icon">üîç</span> Preview Import';
  }
  
  // Remove file
  removeFileBtn.addEventListener('click', function() {
    fileInput.value = '';
    fileInfo.style.display = 'none';
    uploadSubmit.disabled = true;
    uploadSubmit.innerHTML = '<span class="btn-icon">üîç</span> Preview Import';
  });
  
  // Format file size
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
  
  // Download template
  downloadTemplate.addEventListener('click', function(e) {
    e.preventDefault();
    
    // Create sample CSV content
    const csvContent = [
      'Name,Title,Department,Salary,Hours,Phone,Email,Hire Date,Employment Type,Status',
      'John Doe,Software Engineer,Engineering,75000,40,(555) 123-4567,john.doe@company.com,2024-01-15,W2,Active',
      'Jane Smith,Project Manager,Operations,65000,40,(555) 987-6543,jane.smith@company.com,2024-02-01,W2,Active',
      'Bob Johnson,Contractor,Consulting,45,40,(555) 456-7890,bob.johnson@consultant.com,2024-03-01,1099,Active'
    ].join('\n');
    
    // Create and download file
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'employee_import_template.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    console.log('üìÑ CSV template downloaded');
  });
  
  console.log('‚úÖ Import Form Ready');
});
</script>